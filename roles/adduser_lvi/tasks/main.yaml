---

vars_prompt:
 - name: "init_password"    
   prompt: "Enter a password for the user lvi"    
   private: yes    
   encrypt: "md5_crypt" #need to have python-passlib installed in local machine before we can use it    
   confirm: yes    
   salt_size: 7

- name: Create the lvi group
  group: 
    name: lvi 
    state: present

- name: Initial admin user creation - lvi.
  user: 
    name: lvi 
    password: "init_password"   
    shell: /bin/bash 
    createhome: yes 
    home: /home/lvi 
    groups: lvi,sudo,admins,sshusers
    append: yes

- name: User lvi will have to change password at first connection.
  shell: chage -d O lvi

- name: Create .ssh/ directory in lvi home directory  
  file: 
    path: /home/lvi/.ssh 
    state: directory
    owner: lvi
    group: lvi  
    mode: "u=rw,g=rw,o=r"

- name: Adding the lvi public key to authorized_keys files.
  authorized_key: 
    user: lvi 
    key: "{{ lookup('file', '/root/.ssh/lvi_rsa.pub') }}"